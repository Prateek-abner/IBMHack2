<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Test Case Generator - IBM Granite</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>🤖 AI-Powered Test Case Generator</h1>
            <p>Generate comprehensive JUnit test cases from your Spring Boot APIs using <strong>IBM Granite 3.0 8B Instruct</strong></p>
        </header>
        
        <div class="main-content">
            <form method="POST" action="/" id="testGenForm">
                <div class="form-group">
                    <label for="api_code">
                        <span class="label-text">📝 Paste your Spring Boot Controller or API code:</span>
                        <span class="label-hint">Supports @RestController, @GetMapping, @PostMapping, etc.</span>
                    </label>
                    <textarea 
                        id="api_code" 
                        name="api_code" 
                        rows="18" 
                        placeholder="@RestController
@RequestMapping(&quot;/api/users&quot;)
public class UserController {
    
    @GetMapping(&quot;/{id}&quot;)
    public ResponseEntity&lt;User&gt; getUser(@PathVariable Long id) {
        User user = userService.findById(id);
        return ResponseEntity.ok(user);
    }
    
    @PostMapping
    public ResponseEntity&lt;User&gt; createUser(@RequestBody @Valid User user) {
        User createdUser = userService.save(user);
        return ResponseEntity.status(HttpStatus.CREATED).body(createdUser);
    }
    
    @DeleteMapping(&quot;/{id}&quot;)
    public ResponseEntity&lt;Void&gt; deleteUser(@PathVariable Long id) {
        userService.delete(id);
        return ResponseEntity.noContent().build();
    }
}">{{ request.form.api_code }}</textarea>
                </div>
                
                <div class="button-group">
                    <button type="submit" class="btn-generate" id="generateBtn">
                        <span class="btn-text">🚀 Generate Test Cases</span>
                        <span class="btn-loading" style="display: none;">⏳ Generating...</span>
                    </button>
                    <button type="button" class="btn-clear" onclick="clearForm()">🗑️ Clear</button>
                </div>
            </form>
            
            {% if api_analysis %}
            <div class="analysis-info">
                <h3>📊 API Analysis</h3>
                <div class="analysis-stats">
                    <span class="stat">Endpoints: {{ api_analysis.endpoint_count }}</span>
                    <span class="stat">Path Variables: {{ "Yes" if api_analysis.has_path_variables else "No" }}</span>
                    <span class="stat">Request Body: {{ "Yes" if api_analysis.has_request_body else "No" }}</span>
                    <span class="stat">Validation: {{ "Yes" if api_analysis.has_validation else "No" }}</span>
                </div>
            </div>
            {% endif %}
            
            {% if generated_tests %}
            <div class="results">
                <div class="results-header">
                    <h2>✅ Generated Test Cases</h2>
                    <div class="results-actions">
                        <button onclick="copyToClipboard()" class="btn-copy">📋 Copy All</button>
                        <button onclick="downloadTests()" class="btn-download">💾 Download</button>
                    </div>
                </div>
                
                <div class="test-output">
                    <pre><code id="testCode">{{ generated_tests }}</code></pre>
                </div>
                
                <div class="test-info">
                    <p><strong>Generated by:</strong> IBM Granite 3.0 8B Instruct</p>
                    <p><strong>Framework:</strong> JUnit 5 + RestAssured</p>
                    <p><strong>Test Types:</strong> Functional, Error Handling, Boundary, Validation</p>
                </div>
            </div>
            {% endif %}
            
            {% if error %}
            <div class="error">
                <h3>❌ Error</h3>
                <p>{{ error }}</p>
                <details>
                    <summary>Troubleshooting Tips</summary>
                    <ul>
                        <li>Ensure your API code is valid Spring Boot syntax</li>
                        <li>Check that environment variables are properly set</li>
                        <li>Verify your IBM Cloud credentials are active</li>
                    </ul>
                </details>
            </div>
            {% endif %}
        </div>
        
        <footer>
            <p>Powered by <strong>IBM Granite 3.0 8B Instruct</strong> | Built for Hackathon 2025</p>
        </footer>
    </div>

    <script>
        function copyToClipboard() {
            const testCode = document.getElementById('testCode').textContent;
            navigator.clipboard.writeText(testCode).then(function() {
                showNotification('✅ Test cases copied to clipboard!');
            }).catch(function() {
                showNotification('❌ Failed to copy to clipboard');
            });
        }
        
        function downloadTests() {
            const testCode = document.getElementById('testCode').textContent;
            const blob = new Blob([testCode], { type: 'text/java' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'GeneratedTests.java';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            showNotification('💾 Test file downloaded!');
        }
        
        function clearForm() {
            document.getElementById('api_code').value = '';
            document.getElementById('api_code').focus();
        }
        
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // Form submission with loading state
        document.getElementById('testGenForm').addEventListener('submit', function() {
            const btn = document.getElementById('generateBtn');
            const btnText = btn.querySelector('.btn-text');
            const btnLoading = btn.querySelector('.btn-loading');
            
            btnText.style.display = 'none';
            btnLoading.style.display = 'inline';
            btn.disabled = true;
        });
    </script>
</body>
</html>
